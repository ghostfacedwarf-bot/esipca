# Progress Report - 28 Ianuarie 2026

## Rezumat
Implementare sistem de prețuri regionale (România vs Europa) cu detectare automată din IP și conversie EUR.

---

## Funcționalități Implementate

### 1. Selector Regiune (RO/EU)
- **Locație:** Header-ul site-ului
- **Componente:** `RegionSelector.tsx`, `RegionAutoDetect.tsx`
- **Store:** Zustand (`useRegionStore` în `lib/store.ts`)
- Steaguri SVG pentru România și UE
- Actualizare live a prețurilor când se schimbă regiunea

### 2. Auto-Detectare Regiune din IP
- **API:** `/api/geo/route.ts`
- Folosește header-ul Vercel `x-vercel-ip-country` (pe Vercel)
- Fallback la `ip-api.com` pentru alte platforme
- IP din România → RO, orice alt IP → EU
- Se salvează în localStorage, nu suprascrie selecția manuală

### 3. Prețuri Regionale
- **România (RO):** Preț de bază
- **Europa (EU):** Preț dublu (×2)
- Prețurile se actualizează instant când se schimbă regiunea
- Afișare pe: pagina principală, lista produse, pagina produs

### 4. Conversie EUR (Curs BNR)
- **API:** `/api/exchange-rate/route.ts`
- **Hook:** `lib/useExchangeRate.ts`
- Preia cursul EUR/RON de la BNR (cache 1 oră)
- Afișează `~X.XX EUR` sub fiecare preț în RON

### 5. Fix Calculator în Alte Limbi
- Adăugat `notranslate` pe formularul de comandă
- Previne Google Translate să strice valorile din selectoare

---

## Fișiere Noi Create
```
app/api/exchange-rate/route.ts     - API curs BNR
app/api/geo/route.ts               - API detectare IP (exista deja)
app/components/RegionAutoDetect.tsx - Auto-detectare regiune
app/components/RegionSelector.tsx   - Selector RO/EU (modificat)
app/components/FeaturedProductCard.tsx - Card produs homepage
app/produse/ProductCard.tsx         - Card produs lista
lib/useExchangeRate.ts              - Hook pentru curs EUR
lib/store.ts                        - Zustand store pentru regiune
prisma/fix-media-urls.ts            - Script fix poze P16/P17
```

## Fișiere Modificate
```
app/layout.tsx                      - Adăugat RegionAutoDetect
app/page.tsx                        - Folosește FeaturedProductCard
app/produse/page.tsx                - Folosește ProductCard
app/produse/[slug]/ProductOrderForm.tsx - Prețuri regionale + EUR
app/produse/[slug]/page.tsx         - Cleanup
app/components/GoogleTranslator.tsx - Text buton "Translate"
lib/region-context.tsx              - Re-export din store
prisma/schema.prisma                - Câmp priceEU (anterior)
```

---

## Commits
1. `f4fea2a` - feat: Add regional pricing (RO/EU) with EUR conversion
2. `aaf4a7d` - feat: Add auto-detection of region based on IP

---

## De Făcut (TODO)
- [ ] Testare pe Vercel cu IP-uri reale din alte țări
- [ ] Adăugare priceEU în baza de date pentru toate variantele
- [ ] Verificare că coșul recalculează corect la schimbarea regiunii

---

## Note Tehnice
- Zustand funcționează mai bine decât React Context pentru actualizări live
- BNR XML feed: `https://www.bnr.ro/nbrfxrates.xml`
- ip-api.com: gratuit, max 45 req/min
